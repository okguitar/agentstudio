# 调度器状态显示

## 功能说明

在定时任务管理界面右上角,现在会显示当前后端实例的调度器状态。

## 界面显示

### 调度器已启用
```
┌─────────────────────────────────────┐
│ 定时任务                            │
│ 配置 Agent 的自动执行计划           │
└─────────────────────────────────────┘

[🟢 调度器已启用] [⚙️ 活跃: 3 / 运行中: 0]  [+ 新建任务]
```

- **绿色背景 + "调度器已启用"**: 调度器正在运行,任务会自动执行
- **灰色文字 + 任务统计**: 显示当前活跃任务数量和正在运行的任务数量

### 调度器已禁用
```
┌─────────────────────────────────────┐
│ 定时任务                            │
│ 配置 Agent 的自动执行计划           │
└─────────────────────────────────────┘

[🟠 调度器已禁用] [⚙️ 活跃: 0 / 运行中: 0]  [+ 新建任务]
```

- **橙色背景 + "调度器已禁用"**: 调度器未运行,任务不会自动执行
- **灰色文字 + 任务统计**: 显示任务统计(禁用时活跃任务为 0)

## 技术实现

### 后端 API
调度器状态通过 `/api/scheduled-tasks/status` 端点返回:

```json
{
  "isInitialized": true,
  "enabled": true,
  "config": {
    "maxConcurrent": 3
  },
  "activeTaskCount": 3,
  "runningTaskCount": 0
}
```

- `enabled`: `true` 表示调度器启用,`false` 表示禁用
- `isInitialized`: 调度器是否已初始化
- `activeTaskCount`: 当前已调度的任务数量
- `runningTaskCount`: 正在执行的任务数量

### 前端显示
使用 React Query 的 `useSchedulerStatus` hook 获取状态,每30秒自动刷新一次。

## 控制调度器开关

通过环境变量 `ENABLE_SCHEDULER` 控制:

```bash
# 启用调度器 (默认)
ENABLE_SCHEDULER=true

# 禁用调度器
ENABLE_SCHEDULER=false
```

参见 `docs/SCHEDULER_CONTROL.md` 了解更多详情。

## 使用场景

### 多实例部署
- **主实例**: 显示 "🟢 调度器已启用",自动执行定时任务
- **工作实例**: 显示 "🟠 调度器已禁用",仅处理手动任务和 API 请求

### 开发环境
- 开发时可以禁用调度器,避免定时任务自动运行干扰开发
- 需要测试时仍然可以手动点击 "立即执行" 按钮运行任务

### 监控和调试
- 快速确认当前实例是否在运行调度器
- 避免多个实例同时运行相同的定时任务
